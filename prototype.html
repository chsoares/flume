<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fluxo de Caixa Pessoal 2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Estilos customizados */
        .table-container { overflow-x: auto; width: 100%; }
        td, th { min-width: 100px; white-space: nowrap; }
        .col-month { min-width: 80px; }
        .col-currency { min-width: 110px; }
        .col-desc { min-width: 180px; max-width: 250px; white-space: normal; }
        
        input[type="number"] { -moz-appearance: textfield; }
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        
        .tab-active { border-bottom: 2px solid #2563eb; color: #2563eb; font-weight: 600; }
        .tab-inactive { border-bottom: 2px solid transparent; color: #64748b; }
        .tab-inactive:hover { color: #334155; }

        /* Helper para quebra de linha nas descrições */
        .desc-line { display: block; line-height: 1.4; }
    </style>
</head>
<body class="bg-slate-900 min-h-screen p-4 md:p-8 font-sans text-slate-800">

    <div class="max-w-[1600px] mx-auto">
        
        <!-- Header -->
        <div class="bg-white rounded-xl shadow-2xl p-6 mb-6">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                <div>
                    <h1 class="text-3xl font-bold text-slate-800">Fluxo de Caixa 2025</h1>
                    <p class="text-slate-500">Planejamento Financeiro Anual</p>
                </div>
                <div class="text-right">
                    <div class="text-sm text-slate-500">Investimento Inicial</div>
                    <div class="text-xl font-bold text-slate-700">R$ 57.000,00</div>
                    <div class="text-xs text-slate-400">VT: 55k | CDB: 2k</div>
                </div>
            </div>
        </div>

        <!-- Summary Cards -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
            <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-blue-500">
                <div class="flex justify-between items-center">
                    <span class="text-slate-500 font-medium">Saldo Anual Previsto</span>
                    <i class="fas fa-chart-line text-blue-500 text-xl"></i>
                </div>
                <p id="yearly-balance-display" class="text-2xl font-bold text-slate-800 mt-2">R$ 0,00</p>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-purple-500">
                <div class="flex justify-between items-center">
                    <span class="text-slate-500 font-medium">Saldo Final Previsto</span>
                    <i class="fas fa-wallet text-purple-500 text-xl"></i>
                </div>
                <p id="final-balance-display" class="text-2xl font-bold text-slate-800 mt-2">R$ 0,00</p>
                <div class="text-xs text-slate-400 mt-1">VT: <span id="final-vt"></span> | CDB: <span id="final-cdb"></span></div>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-emerald-500">
                <div class="flex justify-between items-center">
                    <span class="text-slate-500 font-medium">Estratégia</span>
                    <i class="fas fa-piggy-bank text-emerald-500 text-xl"></i>
                </div>
                <p class="text-sm text-slate-600 mt-2">
                    Priorizar CDB até atingir R$ 30k.<br>
                    Depois: 80% VT / 20% CDB.
                </p>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="bg-white rounded-t-xl shadow-lg px-6 pt-6">
            <div class="flex space-x-8 border-b border-slate-200">
                <button onclick="switchTab('config')" id="tab-config" class="pb-3 px-1 transition-colors tab-active">
                    <i class="fas fa-cog mr-2"></i>Configuração
                </button>
                <button onclick="switchTab('projected')" id="tab-projected" class="pb-3 px-1 transition-colors tab-inactive">
                    <i class="fas fa-calculator mr-2"></i>Previsto
                </button>
                <button onclick="switchTab('real')" id="tab-real" class="pb-3 px-1 transition-colors tab-inactive">
                    <i class="fas fa-check-double mr-2"></i>Real
                </button>
            </div>
        </div>

        <!-- Content Area -->
        <div class="bg-white rounded-b-xl shadow-lg p-6 mb-8 min-h-[500px]">
            
            <!-- TAB: CONFIGURAÇÃO -->
            <div id="content-config" class="space-y-8">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Despesas Fixas -->
                    <div>
                        <h3 class="text-lg font-bold text-slate-700 mb-4 border-b pb-2">Despesas Mensais Fixas</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-slate-600 mb-1">Cartão de Crédito</label>
                                <div class="relative">
                                    <span class="absolute left-3 top-2 text-slate-400">R$</span>
                                    <input type="number" id="cfg-credit" value="6000" class="w-full pl-10 pr-3 py-2 border border-slate-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none" onchange="updateCalculations()">
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-600 mb-1">Plano de Saúde</label>
                                <div class="relative">
                                    <span class="absolute left-3 top-2 text-slate-400">R$</span>
                                    <input type="number" id="cfg-health" value="800" class="w-full pl-10 pr-3 py-2 border border-slate-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none" onchange="updateCalculations()">
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-600 mb-1">Condomínio</label>
                                <div class="relative">
                                    <span class="absolute left-3 top-2 text-slate-400">R$</span>
                                    <input type="number" id="cfg-condo" value="600" class="w-full pl-10 pr-3 py-2 border border-slate-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none" onchange="updateCalculations()">
                                </div>
                            </div>
                            <div class="pt-4 bg-slate-50 p-3 rounded text-sm">
                                <p class="text-slate-600">Total Fixo: <span class="font-bold" id="fixed-total-display">R$ 7.400,00</span></p>
                                <p class="text-xs text-slate-400 mt-1">+ Parcela 4k (até Abr) + Parcela 3.2k (contínuo)</p>
                            </div>
                        </div>
                    </div>

                    <!-- Viagens -->
                    <div>
                        <h3 class="text-lg font-bold text-slate-700 mb-4 border-b pb-2">Configuração de Viagens</h3>
                        
                        <!-- Londres -->
                        <div class="mb-6 p-4 border border-blue-200 rounded-lg bg-blue-50">
                            <h4 class="font-semibold text-blue-800 mb-3"><i class="fas fa-plane mr-2"></i>Londres (Fev)</h4>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-xs font-medium text-slate-600 mb-1">Alimentação (£/dia)</label>
                                    <input type="number" id="cfg-london-food" value="50" class="w-full px-2 py-1 border border-slate-300 rounded text-sm" onchange="updateCalculations()">
                                </div>
                                <div>
                                    <label class="block text-xs font-medium text-slate-600 mb-1">Lazer (£/dia)</label>
                                    <input type="number" id="cfg-london-leisure" value="30" class="w-full px-2 py-1 border border-slate-300 rounded text-sm" onchange="updateCalculations()">
                                </div>
                            </div>
                            <p class="text-xs text-right text-blue-600 mt-2">Estimativa Total: <span id="london-total-display">R$ 0,00</span></p>
                        </div>

                        <!-- Tailândia -->
                        <div class="p-4 border border-purple-200 rounded-lg bg-purple-50">
                            <h4 class="font-semibold text-purple-800 mb-3"><i class="fas fa-plane mr-2"></i>Tailândia (Nov)</h4>
                            <div class="space-y-3">
                                <div>
                                    <label class="block text-xs font-medium text-slate-600 mb-1">Passagem Aérea (USD)</label>
                                    <input type="number" id="cfg-thai-flight" value="1500" class="w-full px-2 py-1 border border-slate-300 rounded text-sm" onchange="updateCalculations()">
                                </div>
                                <div>
                                    <label class="block text-xs font-medium text-slate-600 mb-1">Câmbio (USD/BRL)</label>
                                    <input type="number" id="cfg-thai-exchange" value="5.8" step="0.1" class="w-full px-2 py-1 border border-slate-300 rounded text-sm" onchange="updateCalculations()">
                                </div>
                                <div>
                                    <label class="block text-xs font-medium text-slate-600 mb-1">Gastos Diários (R$)</label>
                                    <input type="number" id="cfg-thai-daily" value="300" class="w-full px-2 py-1 border border-slate-300 rounded text-sm" onchange="updateCalculations()">
                                </div>
                            </div>
                            <p class="text-xs text-right text-purple-600 mt-2">Estimativa Total: <span id="thai-total-display">R$ 0,00</span></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- TAB: PREVISTO -->
            <div id="content-projected" class="hidden">
                <div class="table-container">
                    <table class="w-full text-left border-collapse">
                        <thead>
                            <tr class="bg-slate-100 text-slate-600 text-sm uppercase tracking-wider">
                                <th class="p-4 border-b col-month">Mês</th>
                                <th class="p-4 border-b text-right col-currency">Salário</th>
                                <th class="p-4 border-b text-right col-currency">Extras</th>
                                <th class="p-4 border-b text-right col-currency font-bold">Receita Total</th>
                                <th class="p-4 border-b text-right col-currency">Despesas</th>
                                <th class="p-4 border-b text-right col-currency">Saldo</th>
                                <th class="p-4 border-b text-right col-currency bg-green-50">CDB</th>
                                <th class="p-4 border-b text-right col-currency bg-purple-50">VT</th>
                                <th class="p-4 border-b text-right col-currency font-bold">Total Inv.</th>
                            </tr>
                        </thead>
                        <tbody id="table-body-projected" class="text-sm text-slate-700 divide-y divide-slate-100">
                            <!-- JS vai preencher -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- TAB: REAL -->
            <div id="content-real" class="hidden">
                <p class="mb-4 text-sm text-slate-500 bg-yellow-50 p-3 rounded border border-yellow-200">
                    <i class="fas fa-info-circle mr-2"></i>
                    Edite o que realmente aconteceu. O sistema calcula automaticamente as despesas e aportes.
                    Campos editáveis: <strong>Salário, Extras Recebidos, Saldo CDB Final, Saldo VT Final</strong>.
                </p>
                <div class="table-container">
                    <table class="w-full text-left border-collapse">
                        <thead>
                            <tr class="bg-slate-100 text-slate-600 text-sm uppercase tracking-wider">
                                <th class="p-4 border-b col-month">Mês</th>
                                <th class="p-4 border-b text-right col-currency">Salário</th>
                                <th class="p-4 border-b text-right col-currency">Extras Rec.</th>
                                <th class="p-4 border-b text-right col-currency">Total Recebido</th>
                                <th class="p-4 border-b text-right col-currency bg-red-50">Despesas (Calc)</th>
                                <th class="p-4 border-b text-right col-currency bg-green-50">CDB Final</th>
                                <th class="p-4 border-b text-right col-currency bg-purple-50">VT Final</th>
                                <th class="p-4 border-b text-right col-currency">Aporte/Resgate</th>
                            </tr>
                        </thead>
                        <tbody id="table-body-real" class="text-sm text-slate-700 divide-y divide-slate-100">
                            <!-- JS vai preencher -->
                        </tbody>
                    </table>
                </div>
            </div>

        </div>
    </div>

    <script>
        // --- DADOS INICIAIS E ESTADO ---
        const MONTHS = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];
        
        let config = {
            grossSalary: 22661,
            netSalaryBase: 15611,
            // O aumento no líquido é derivado da taxa de desconto
            salaryIncreaseMonth: 5, 
            salaryIncreaseAmount: 2000, // Aumento Bruto
            
            creditCard: 6000,
            healthInsurance: 800,
            condo: 600,
            
            installment1: 4000, 
            installment2: 3200, 
            
            london: {
                foodGBP: 50,
                leisureGBP: 30,
                days: 15,
                exchangeGBP: 7.2,
                parentsMoney: 15000
            },
            
            thailand: {
                packageUSD: 3390,
                flightUSD: 1500,
                exchangeUSD: 5.8,
                dailyBRL: 300,
                days: 12,
                paymentMonths: [1, 8, 9, 10], 
                paymentPercents: [0.20, 0.30, 0.20, 0.30],
                flightMonth: 5 
            }
        };

        let realData = [];

        // --- FUNÇÕES DE CÁLCULO ---

        function formatCurrency(value, decimals = 2) {
            return new Intl.NumberFormat('pt-BR', { 
                style: 'currency', 
                currency: 'BRL',
                minimumFractionDigits: decimals,
                maximumFractionDigits: decimals
            }).format(value);
        }

        function getIncomeDetails(monthIndex) {
            const month = monthIndex + 1;
            let gross = config.grossSalary;
            
            // Taxa de desconto fixa baseada nos valores iniciais
            const discountRate = (config.grossSalary - config.netSalaryBase) / config.grossSalary;

            // Aumento Salarial a partir de Maio (aplica ao Bruto)
            if (month >= config.salaryIncreaseMonth) {
                gross += config.salaryIncreaseAmount;
            }

            // Calcula o líquido baseado na taxa de desconto
            const net = gross * (1 - discountRate);

            let extras = 0;
            let extrasList = []; // Lista de objetos {label: "Férias", value: 123}

            // Fevereiro (Index 1)
            if (month === 2) {
                // 1/3 Férias (Adicional sobre o bruto atual, com desconto)
                const vacGross = gross / 3;
                const vacNet = vacGross * (1 - discountRate);
                extras += vacNet;
                extrasList.push({ label: "Férias", value: vacNet });

                // 13º 1ª Parcela (50% Bruto s/ desconto)
                const parcel1 = gross / 2;
                extras += parcel1;
                extrasList.push({ label: "13º 1", value: parcel1 });
            }

            // Dezembro (Index 11)
            if (month === 12) {
                // 13º Total Líquido
                const total13Net = gross * (1 - discountRate);
                
                // 1ª Parcela paga em Fevereiro
                // Recalcula o bruto de fevereiro para precisão
                let grossInFeb = config.grossSalary;
                if (config.salaryIncreaseMonth <= 2) grossInFeb += config.salaryIncreaseAmount;
                const parcel1Paid = grossInFeb / 2;

                const parcel2 = total13Net - parcel1Paid;
                if (parcel2 > 0) {
                    extras += parcel2;
                    extrasList.push({ label: "13º 2", value: parcel2 });
                }
            }

            return { net, extras, extrasList };
        }

        function getExpensesDetails(monthIndex) {
            const month = monthIndex + 1;
            let fixed = config.creditCard + config.healthInsurance + config.condo;
            let installments = 0;
            if (monthIndex < 4) installments += config.installment1;
            installments += config.installment2;

            let trip = 0;
            let tripDesc = '';

            // Londres (Fevereiro)
            if (month === 2) {
                const dailyTotal = config.london.foodGBP + config.london.leisureGBP;
                trip = dailyTotal * config.london.days * config.london.exchangeGBP;
                tripDesc = 'Londres (Viagem)';
            }

            // Tailândia Pagamentos (Pacote)
            const payIdx = config.thailand.paymentMonths.indexOf(month);
            if (payIdx !== -1) {
                const valUSD = config.thailand.packageUSD * config.thailand.paymentPercents[payIdx];
                trip += valUSD * config.thailand.exchangeUSD;
                const percent = (config.thailand.paymentPercents[payIdx] * 100).toFixed(0);
                tripDesc = `Tailândia (Pag ${percent}%)`;
            }

            // Tailândia Passagem (Maio)
            if (month === config.thailand.flightMonth) {
                trip += config.thailand.flightUSD * config.thailand.exchangeUSD;
                tripDesc = 'Tailândia (Passagem)';
            }

            // Tailândia Gastos (Novembro)
            if (month === 11) {
                trip += config.thailand.dailyBRL * config.thailand.days;
                tripDesc = 'Tailândia (Viagem)';
            }

            return { fixed, installments, trip, tripDesc, total: fixed + installments + trip };
        }

        function calculateProjected() {
            let cdb = 2000;
            let vt = 55000;
            const rows = [];

            for (let i = 0; i < 12; i++) {
                const income = getIncomeDetails(i);
                const expenses = getExpensesDetails(i);
                
                let extraIncome = 0;
                let extraList = [];
                
                if (i === 1) { // Fevereiro
                    extraIncome = config.london.parentsMoney;
                    extraList.push({ label: "Pais", value: extraIncome });
                }

                // Junta os extras do salário (férias, 13º) com os extras externos (pais)
                const allExtras = [...income.extrasList, ...extraList];
                const totalExtrasVal = allExtras.reduce((acc, curr) => acc + curr.value, 0);

                const totalIncome = income.net + totalExtrasVal;
                const balance = totalIncome - expenses.total;

                // Estratégia de Investimento
                let cdbMov = 0;
                let vtMov = 0;
                let suggestion = '';

                const targetCDB = 30000;

                if (balance >= 0) {
                    if (cdb < targetCDB) {
                        const needed = targetCDB - cdb;
                        const toCDB = Math.min(balance, needed);
                        cdbMov = toCDB;
                        vtMov = balance - toCDB;
                        suggestion = (toCDB === balance) ? 'Prioriza CDB' : 'Completa CDB + VT';
                    } else {
                        cdbMov = balance * 0.2;
                        vtMov = balance * 0.8;
                        suggestion = '80% VT / 20% CDB';
                    }
                } else {
                    const absBal = Math.abs(balance);
                    if (cdb >= absBal) {
                        cdbMov = -absBal;
                        vtMov = 0;
                        suggestion = 'Resgate CDB';
                    } else {
                        cdbMov = -cdb;
                        vtMov = -(absBal - cdb);
                        suggestion = 'Resgate CDB+VT';
                    }
                }

                cdb += cdbMov;
                vt += vtMov;

                rows.push({
                    month: MONTHS[i],
                    income: income.net,
                    extrasVal: totalExtrasVal,
                    extrasList: allExtras, // Lista formatada
                    totalIncome,
                    expenses: expenses.total,
                    tripDesc: expenses.tripDesc,
                    balance,
                    cdbMov,
                    vtMov,
                    cdb,
                    vt,
                    totalInv: cdb + vt,
                    suggestion
                });
            }
            return rows;
        }

        function initializeRealData(projectedRows) {
            if (realData.length === 12) return; 
            realData = projectedRows.map(row => ({
                month: row.month,
                salary: row.income,
                extrasRec: row.extrasVal,
                expenses: row.expenses,
                cdbEnd: row.cdb,
                vtEnd: row.vt
            }));
        }

        function calculateRealRows() {
            let cdbPrev = 2000;
            let vtPrev = 55000;
            const rows = [];

            realData.forEach((data, i) => {
                const salary = parseFloat(data.salary) || 0;
                const extras = parseFloat(data.extrasRec) || 0;
                const cdbEnd = parseFloat(data.cdbEnd) || 0;
                const vtEnd = parseFloat(data.vtEnd) || 0;

                const totalIncome = salary + extras;
                
                const cdbMov = cdbEnd - cdbPrev;
                const vtMov = vtEnd - vtPrev;

                const totalInvestmentChange = (cdbEnd + vtEnd) - (cdbPrev + vtPrev);
                const expenses = totalIncome - totalInvestmentChange;

                rows.push({
                    month: data.month,
                    salary,
                    extras,
                    totalIncome,
                    expenses,
                    cdbEnd,
                    vtEnd,
                    cdbMov,
                    vtMov,
                    totalInv: cdbEnd + vtEnd
                });

                cdbPrev = cdbEnd;
                vtPrev = vtEnd;
            });

            return rows;
        }

        // --- RENDERIZAÇÃO ---

        function renderTableProjected() {
            const rows = calculateProjected();
            initializeRealData(rows);

            const tbody = document.getElementById('table-body-projected');
            tbody.innerHTML = '';

            rows.forEach((row, i) => {
                const tr = document.createElement('tr');
                tr.className = i % 2 === 0 ? 'bg-white' : 'bg-slate-50';
                
                // Renderiza legendas extras em linhas separadas
                let extrasHtml = '';
                if (row.extrasList.length > 0) {
                    extrasHtml = `
                        <div class="font-semibold text-slate-700">${formatCurrency(row.extrasVal)}</div>
                        <div class="text-xs text-slate-400 leading-tight">
                            ${row.extrasList.map(e => `<span class="desc-line text-slate-400">${e.label}</span>`).join('')}
                        </div>
                    `;
                } else {
                    extrasHtml = '<span class="text-slate-300">-</span>';
                }

                // Renderiza Despesas
                let expenseHtml = `<div>${formatCurrency(row.expenses)}</div>`;
                if (row.tripDesc) {
                    expenseHtml += `<div class="text-xs text-slate-400 mt-1">${row.tripDesc}</div>`;
                }

                tr.innerHTML = `
                    <td class="p-4 font-medium text-slate-900 border-b">${row.month}</td>
                    <td class="p-4 text-right text-slate-600 border-b">${formatCurrency(row.income)}</td>
                    <td class="p-4 text-right text-green-600 border-b">${extrasHtml}</td>
                    <td class="p-4 text-right font-bold text-slate-800 border-b">${formatCurrency(row.totalIncome)}</td>
                    <td class="p-4 text-right text-red-500 border-b">${expenseHtml}</td>
                    <td class="p-4 text-right font-bold ${row.balance >= 0 ? 'text-green-600' : 'text-red-600'} border-b">${formatCurrency(row.balance)}</td>
                    <td class="p-4 text-right border-b bg-green-50/50">
                        <div class="text-xs text-slate-500">${row.cdbMov !== 0 ? (row.cdbMov > 0 ? '+' : '') + formatCurrency(row.cdbMov) : ''}</div>
                        <div class="font-bold text-green-800">${formatCurrency(row.cdb)}</div>
                    </td>
                    <td class="p-4 text-right border-b bg-purple-50/50">
                        <div class="text-xs text-slate-500">${row.vtMov !== 0 ? (row.vtMov > 0 ? '+' : '') + formatCurrency(row.vtMov) : ''}</div>
                        <div class="font-bold text-purple-800">${formatCurrency(row.vt)}</div>
                    </td>
                    <td class="p-4 text-right font-bold text-slate-800 border-b">${formatCurrency(row.totalInv)}</td>
                `;
                tbody.appendChild(tr);
            });

            const lastRow = rows[rows.length - 1];
            document.getElementById('final-balance-display').innerText = formatCurrency(lastRow.totalInv);
            document.getElementById('final-vt').innerText = formatCurrency(lastRow.vt);
            document.getElementById('final-cdb').innerText = formatCurrency(lastRow.cdb);
            
            const yearlyBalance = lastRow.totalInv - 57000;
            const ybEl = document.getElementById('yearly-balance-display');
            ybEl.innerText = formatCurrency(yearlyBalance);
            ybEl.className = `text-2xl font-bold mt-2 ${yearlyBalance >= 0 ? 'text-green-600' : 'text-red-600'}`;
        }

        function renderTableReal() {
            const rows = calculateRealRows();
            const tbody = document.getElementById('table-body-real');
            tbody.innerHTML = '';

            rows.forEach((row, i) => {
                const tr = document.createElement('tr');
                tr.className = i % 2 === 0 ? 'bg-white' : 'bg-slate-50';

                // Importante: Formatar valores calculados com 2 casas decimais
                const totalIncomeStr = formatCurrency(parseFloat(row.totalIncome.toFixed(2)));
                const expensesStr = formatCurrency(parseFloat(row.expenses.toFixed(2)));
                const movStr = formatCurrency(parseFloat((row.cdbMov + row.vtMov).toFixed(2)));

                tr.innerHTML = `
                    <td class="p-4 font-medium text-slate-900 border-b">${row.month}</td>
                    <td class="p-4 text-right border-b">
                        <input type="number" value="${row.salary}" 
                            class="w-24 text-right border border-slate-300 rounded px-1 py-1 focus:border-blue-500 outline-none"
                            onchange="updateRealField(${i}, 'salary', this.value)">
                    </td>
                    <td class="p-4 text-right border-b">
                        <input type="number" value="${row.extras}" 
                            class="w-24 text-right border border-slate-300 rounded px-1 py-1 focus:border-blue-500 outline-none"
                            onchange="updateRealField(${i}, 'extrasRec', this.value)">
                    </td>
                    <td class="p-4 text-right font-bold text-slate-800 border-b">${totalIncomeStr}</td>
                    <td class="p-4 text-right text-red-500 font-medium border-b bg-red-50/30">
                        ${expensesStr}
                    </td>
                    <td class="p-4 text-right border-b bg-green-50/50">
                        <div class="flex items-center justify-end">
                            <span class="text-xs mr-1 text-slate-400">R$</span>
                            <input type="number" value="${row.cdbEnd}" 
                                class="w-28 text-right border border-green-300 rounded px-1 py-1 focus:border-green-500 outline-none font-bold text-green-800 bg-white"
                                onchange="updateRealField(${i}, 'cdbEnd', this.value)">
                        </div>
                    </td>
                    <td class="p-4 text-right border-b bg-purple-50/50">
                        <div class="flex items-center justify-end">
                            <span class="text-xs mr-1 text-slate-400">R$</span>
                            <input type="number" value="${row.vtEnd}" 
                                class="w-28 text-right border border-purple-300 rounded px-1 py-1 focus:border-purple-500 outline-none font-bold text-purple-800 bg-white"
                                onchange="updateRealField(${i}, 'vtEnd', this.value)">
                        </div>
                    </td>
                    <td class="p-4 text-right border-b">
                        <span class="${row.cdbMov + row.vtMov >= 0 ? 'text-green-600' : 'text-red-600'} text-xs font-medium">
                            ${movStr}
                        </span>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function updateRealField(index, field, value) {
            realData[index][field] = parseFloat(value);
            renderTableReal();
        }

        function updateConfigDisplays() {
            document.getElementById('fixed-total-display').innerText = formatCurrency(config.creditCard + config.healthInsurance + config.condo);
            const londonTotal = (config.london.foodGBP + config.london.leisureGBP) * config.london.days * config.london.exchangeGBP;
            document.getElementById('london-total-display').innerText = formatCurrency(londonTotal);
            const thaiTotal = (config.thailand.packageUSD + config.thailand.flightUSD) * config.thailand.exchangeUSD + (config.thailand.dailyBRL * config.thailand.days);
            document.getElementById('thai-total-display').innerText = formatCurrency(thaiTotal);
        }

        function switchTab(tabName) {
            ['config', 'projected', 'real'].forEach(t => {
                document.getElementById(`content-${t}`).classList.add('hidden');
                document.getElementById(`tab-${t}`).classList.remove('tab-active');
                document.getElementById(`tab-${t}`).classList.add('tab-inactive');
            });
            document.getElementById(`content-${tabName}`).classList.remove('hidden');
            document.getElementById(`tab-${tabName}`).classList.remove('tab-inactive');
            document.getElementById(`tab-${tabName}`).classList.add('tab-active');

            if (tabName === 'projected') renderTableProjected();
            if (tabName === 'real') renderTableReal();
        }

        function updateCalculations() {
            config.creditCard = parseFloat(document.getElementById('cfg-credit').value);
            config.healthInsurance = parseFloat(document.getElementById('cfg-health').value);
            config.condo = parseFloat(document.getElementById('cfg-condo').value);
            config.london.foodGBP = parseFloat(document.getElementById('cfg-london-food').value);
            config.london.leisureGBP = parseFloat(document.getElementById('cfg-london-leisure').value);
            config.thailand.flightUSD = parseFloat(document.getElementById('cfg-thai-flight').value);
            config.thailand.exchangeUSD = parseFloat(document.getElementById('cfg-thai-exchange').value);
            config.thailand.dailyBRL = parseFloat(document.getElementById('cfg-thai-daily').value);

            updateConfigDisplays();
            if (!document.getElementById('content-projected').classList.contains('hidden')) {
                renderTableProjected();
            }
        }

        window.onload = function() {
            updateCalculations();
            renderTableProjected();
        };
    </script>
</body>
</html>
